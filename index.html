<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peo by Aditya Jha</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="https://aditya-cmd-max.github.io/Peo/tts.png">
 
    <style>
        :root {
            --primary: #ec4899;
            --primary-light: #f472b6;
            --secondary: #3b82f6;
            --accent: #f59e0b;
            --dark: #111827;
            --darker: #030712;
            --light: #f9fafb;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-subtle: #6b7280;
            --border-color: #374151;
            --input-border: #4b5563;
            --error-color: #ef4444;
            --disabled-bg: #a5b4fc;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: radial-gradient(circle at 10% 20%, var(--darker), var(--dark));
            color: var(--text-primary);
            display: grid;
            place-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
        }

        .container {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 
                        inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            max-width: 550px;
            width: 100%;
            text-align: center;
            position: relative;
        }

        .logo-container {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            padding: 3px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-img {
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .app-header { margin-bottom: 2rem; }
        .app-header h1 { 
            font-size: 2.25rem; 
            font-weight: 700; 
            line-height: 1.2;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .app-header p { 
            font-size: 1rem; 
            color: var(--text-secondary); 
            margin-top: 0.25rem; 
        }

        #wordInput {
            width: 100%;
            padding: 0.875rem 1rem;
            margin-bottom: 1.5rem;
            border: 2px solid var(--input-border);
            border-radius: 0.75rem;
            font-size: 1.125rem;
            background-color: rgba(17, 24, 39, 0.5);
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        #wordInput:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .accent-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .accent-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px -5px rgba(236, 72, 153, 0.3);
        }
        .accent-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px -5px rgba(236, 72, 153, 0.4);
        }
        .accent-btn:disabled {
            background: var(--disabled-bg);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .gemini-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .feature-btn {
            background: rgba(59, 130, 246, 0.2);
            color: var(--text-primary);
            padding: 0.6rem 1.2rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .feature-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        .feature-btn:disabled {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-subtle);
            cursor: not-allowed;
            transform: none;
        }

        #llm-output {
            text-align: left;
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            display: none;
        }
        #llm-output h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }
        #llm-output p {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }
        .llm-loading-spinner {
            font-size: 1.5rem;
            color: var(--secondary);
        }

        .loading-indicator { 
            display: none; 
            margin-top: 1.25rem; 
            font-size: 1rem; 
            color: var(--text-secondary); 
        }
        .error-message { 
            color: var(--error-color); 
            margin-top: 1rem; 
            font-size: 0.9rem; 
            min-height: 1.25rem; 
        }
        #audioPlayer { 
            width: 100%; 
            margin-top: 1.5rem; 
            border-radius: 0.75rem;
            background: rgba(17, 24, 39, 0.5);
        }
        #audioPlayer.hidden { display: none; }
        
        .theme-switcher { 
            position: absolute; 
            top: 1.5rem; 
            right: 1.5rem; 
        }
        .theme-toggle-label { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            width: 50px; 
            height: 26px; 
            background-color: var(--border-color); 
            border-radius: 50px; 
            cursor: pointer; 
            position: relative; 
        }
        .theme-toggle-checkbox { 
            opacity: 0; 
            width: 0; 
            height: 0; 
            position: absolute; 
        }
        .theme-toggle-label .ball { 
            width: 22px; 
            height: 22px; 
            background-color: white; 
            border-radius: 50%; 
            position: absolute; 
            left: 2px; 
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .theme-toggle-checkbox:checked + .theme-toggle-label .ball { 
            transform: translateX(24px); 
        }
        .theme-toggle-label .fa-sun { 
            color: #f39c12; 
            margin-left: 5px; 
        }
        .theme-toggle-label .fa-moon { 
            color: #f1c40f; 
            margin-right: 5px; 
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="theme-switcher">
            <input type="checkbox" id="theme-toggle" class="theme-toggle-checkbox" checked>
            <label for="theme-toggle" class="theme-toggle-label">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
                <span class="ball"></span>
            </label>
        </div>

        <div class="logo-container">
            <img src="https://aditya-cmd-max.github.io/Peo/tts.png" alt="Peo Logo" class="logo-img">
        </div>

        <header class="app-header">
            <h1>Peo by Aditya Jha</h1>
            <p>Your Instant Pronunciation & TTS Assistant</p>
        </header>
        
        <input type="text" id="wordInput" placeholder="Enter a word...">
        
        <div class="accent-buttons" id="accentButtons">
            <button class="accent-btn" data-accent="american" data-voice="Zephyr">American</button>
            <button class="accent-btn" data-accent="british" data-voice="Enceladus">British</button>
            <button class="accent-btn" data-accent="australian" data-voice="Puck">Australian</button>
            <button class="accent-btn" data-accent="indian" data-voice="Alnilam">Indian</button>
        </div>
        
        <div id="loading" class="loading-indicator">
            <i class="fas fa-spinner fa-spin"></i> Loading pronunciation...
        </div>
        <div id="errorMessage" class="error-message"></div>
        
        <audio id="audioPlayer" controls class="hidden"></audio>

        <!-- Gemini Text Features -->
        <div class="gemini-features">
            <button class="feature-btn" id="defineBtn">✨ Define Word</button>
            <button class="feature-btn" id="exampleBtn">✨ Example Sentence</button>
            <button class="feature-btn" id="suggestBtn">✨ Suggest a Word</button>
        </div>

        <div id="llm-output">
            <h3 id="llm-output-title"></h3>
            <p id="llm-output-content"></p>
        </div>
    </div>


    <p>Made with ♥ by Aditya Jha</p>
    <script>
        // DOM Elements
        const wordInput = document.getElementById('wordInput');
        const accentButtonsContainer = document.getElementById('accentButtons');
        const loadingIndicator = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const audioPlayer = document.getElementById('audioPlayer');
        const themeToggle = document.getElementById('theme-toggle');
        const defineBtn = document.getElementById('defineBtn');
        const exampleBtn = document.getElementById('exampleBtn');
        const suggestBtn = document.getElementById('suggestBtn');
        const llmOutput = document.getElementById('llm-output');
        const llmOutputTitle = document.getElementById('llm-output-title');
        const llmOutputContent = document.getElementById('llm-output-content');

        // --- THEME SWITCHER LOGIC ---
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                themeToggle.checked = true;
            } else {
                document.documentElement.classList.remove('dark');
                themeToggle.checked = false;
            }
            localStorage.setItem('theme', theme);
        }

        themeToggle.addEventListener('change', () => {
            applyTheme(themeToggle.checked ? 'dark' : 'light');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(savedTheme || (systemPrefersDark ? 'dark' : 'light'));
        });

        // --- API & HELPER FUNCTIONS ---
        const API_KEY = "AIzaSyAgH_ouPFBcK9_FRPcYJk4K1PEJ0aDmN-c"; // Canvas will provide this

        function base64ToArrayBuffer(base64) { /* ... (unchanged) ... */ 
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); }
            return bytes.buffer;
        }
        function pcmToWav(pcm16, sampleRate) { /* ... (unchanged) ... */ 
            const numChannels = 1, bytesPerSample = 2;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcm16.byteLength;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);
            function writeString(offset, str) { for (let i = 0; i < str.length; i++) { view.setUint8(offset + i, str.charCodeAt(i)); } }
            writeString(0, 'RIFF'); view.setUint32(4, 36 + dataSize, true); writeString(8, 'WAVE');
            writeString(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true); view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true); view.setUint16(32, blockAlign, true);
            view.setUint16(34, 16 * numChannels, true); writeString(36, 'data'); view.setUint32(40, dataSize, true);
            const pcmAsUint8 = new Uint8Array(pcm16.buffer); const wavBytes = new Uint8Array(buffer);
            wavBytes.set(pcmAsUint8, 44);
            return new Blob([wavBytes], { type: 'audio/wav' });
        }
        
        function setInputsDisabled(disabled) {
            wordInput.disabled = disabled;
            document.querySelectorAll('.accent-btn, .feature-btn').forEach(button => {
                button.disabled = disabled;
            });
        }
        
        function showLLMOutputLoading(title) {
            llmOutput.style.display = 'block';
            llmOutputTitle.textContent = title;
            llmOutputContent.innerHTML = '<i class="fas fa-spinner fa-spin llm-loading-spinner"></i>';
        }

        // --- CORE API CALLS ---
        
        // Function for Text-to-Speech API
        async function getPronunciation(word, accent, voiceName) {
            errorMessage.textContent = '';
            audioPlayer.classList.add('hidden');
            loadingIndicator.style.display = 'block';
            setInputsDisabled(true);

            const payload = {
                contents: [{ role: "user", parts: [{ text: `Say in a standard ${accent} accent: ${word}` }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName } } }
                },
                model: "gemini-2.5-flash-preview-tts"
            };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`API error: ${errorData.error.message || response.statusText}`); }
                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                if (part?.inlineData?.data && part.inlineData.mimeType?.startsWith("audio/")) {
                    const rateMatch = part.inlineData.mimeType.match(/rate=(\d+)/);
                    const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 16000;
                    const pcm16 = new Int16Array(base64ToArrayBuffer(part.inlineData.data));
                    const audioUrl = URL.createObjectURL(pcmToWav(pcm16, sampleRate));
                    audioPlayer.src = audioUrl;
                    audioPlayer.classList.remove('hidden');
                    audioPlayer.play();
                } else { throw new Error("Invalid or no audio data received."); }
            } catch (error) {
                console.error("Pronunciation Error:", error);
                errorMessage.textContent = `Failed to get pronunciation.`;
            } finally {
                loadingIndicator.style.display = 'none';
                setInputsDisabled(false);
            }
        }

        // Generic function for Text Generation API
        async function callGeminiTextAPI(prompt, outputTitle) {
            errorMessage.textContent = '';
            showLLMOutputLoading(outputTitle);
            setInputsDisabled(true);

            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`API error: ${errorData.error.message || response.statusText}`); }
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    return text.trim();
                } else {
                    throw new Error("No text content received from API.");
                }
            } catch (error) {
                console.error("Gemini Text API Error:", error);
                errorMessage.textContent = `Failed to get response. Please try again.`;
                llmOutput.style.display = 'none';
                return null;
            } finally {
                setInputsDisabled(false);
            }
        }

        // --- EVENT LISTENERS ---

        // Pronunciation buttons (Event Delegation)
        accentButtonsContainer.addEventListener('click', (event) => {
            const button = event.target.closest('.accent-btn');
            if (button) {
                const word = wordInput.value.trim();
                if (word) {
                    getPronunciation(word, button.dataset.accent, button.dataset.voice);
                } else {
                    errorMessage.textContent = "Please enter a word first.";
                    wordInput.focus();
                }
            }
        });

        // Define Word button
        defineBtn.addEventListener('click', async () => {
            const word = wordInput.value.trim();
            if (!word) { errorMessage.textContent = "Please enter a word to define."; return; }
            const prompt = `Define the word "${word}" in a simple, clear way.`;
            const definition = await callGeminiTextAPI(prompt, `Definition of "${word}"`);
            if (definition) {
                llmOutputContent.textContent = definition;
            }
        });

        // Example Sentence button
        exampleBtn.addEventListener('click', async () => {
            const word = wordInput.value.trim();
            if (!word) { errorMessage.textContent = "Please enter a word for an example."; return; }
            const prompt = `Use the word "${word}" in a simple, clear example sentence.`;
            const example = await callGeminiTextAPI(prompt, `Example for "${word}"`);
            if (example) {
                llmOutputContent.textContent = example;
            }
        });

        // Suggest a Word button
        suggestBtn.addEventListener('click', async () => {
            const prompt = `Suggest an interesting but useful English word. Respond ONLY with a valid JSON object with three keys: "word", "definition", and "example".`;
            const responseText = await callGeminiTextAPI(prompt, "Suggesting a Word...");
            if (responseText) {
                try {
                    // Clean the response to ensure it's valid JSON
                    const jsonString = responseText.match(/\{.*\}/s)[0];
                    const data = JSON.parse(jsonString);
                    if (data.word && data.definition && data.example) {
                        wordInput.value = data.word;
                        llmOutputTitle.textContent = `Suggested Word: ${data.word}`;
                        llmOutputContent.innerHTML = `<strong>Definition:</strong> ${data.definition}<br><br><strong>Example:</strong> ${data.example}`;
                    } else {
                        throw new Error("Invalid JSON structure from API.");
                    }
                } catch (e) {
                    console.error("JSON parsing error:", e);
                    errorMessage.textContent = "Could not get a suggestion. Let's try again.";
                    llmOutput.style.display = 'none';
                }
            }
        });

        // Trigger default pronunciation on Enter key
        wordInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                document.querySelector('.accent-btn').click();
            }
        });
    </script>
</body>
</html>
